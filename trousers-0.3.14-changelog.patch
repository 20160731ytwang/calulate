From d5281d75865cdb5bbd1574190a4900a8dacd85f5 Mon Sep 17 00:00:00 2001
From: lianyq <yqlian@acorn-net.com>
Date: Thu, 19 Jan 2017 12:41:37 +0800
Subject: [PATCH] porting tss for z32h320

---
 src/include/tss/tpm_ordinal.h | 248 +++++++++++++++++++++---------------------
 src/tcs/tcs_caps.c            |   4 +
 src/tspi/obj_context.c        |   4 +-
 3 files changed, 131 insertions(+), 125 deletions(-)

diff --git a/src/include/tss/tpm_ordinal.h b/src/include/tss/tpm_ordinal.h
index 9df9959..2674c5b 100644
--- a/src/include/tss/tpm_ordinal.h
+++ b/src/include/tss/tpm_ordinal.h
@@ -5,7 +5,7 @@
 #ifndef __TPM_ORDINAL_H__
 #define __TPM_ORDINAL_H__
 
-#define TPM_PROTECTED_COMMAND                     ((UINT32)(0x00000000))
+#define TPM_PROTECTED_COMMAND                     ((UINT32)(0x00008000))
 #define TPM_UNPROTECTED_COMMAND                   ((UINT32)(0x80000000))
 #define TPM_CONNECTION_COMMAND                    ((UINT32)(0x40000000))
 #define TPM_VENDOR_COMMAND                        ((UINT32)(0x20000000))
@@ -21,129 +21,129 @@
 #define TPM_CONNECTION_ORDINAL             (TPM_MAIN | TPM_CONNECTION_COMMAND)
 
 
-#define TPM_ORD_OIAP                              ((UINT32)0x0000000A)
-#define TPM_ORD_OSAP                              ((UINT32)0x0000000B)
-#define TPM_ORD_ChangeAuth                        ((UINT32)0x0000000C)
-#define TPM_ORD_TakeOwnership                     ((UINT32)0x0000000D)
-#define TPM_ORD_ChangeAuthAsymStart               ((UINT32)0x0000000E)
-#define TPM_ORD_ChangeAuthAsymFinish              ((UINT32)0x0000000F)
-#define TPM_ORD_ChangeAuthOwner                   ((UINT32)0x00000010)
-#define TPM_ORD_DSAP                              ((UINT32)0x00000011)
-#define TPM_ORD_CMK_CreateTicket                  ((UINT32)0x00000012)
-#define TPM_ORD_CMK_CreateKey                     ((UINT32)0x00000013)
-#define TPM_ORD_Extend                            ((UINT32)0x00000014)
-#define TPM_ORD_PcrRead                           ((UINT32)0x00000015)
-#define TPM_ORD_Quote                             ((UINT32)0x00000016)
-#define TPM_ORD_Seal                              ((UINT32)0x00000017)
-#define TPM_ORD_Unseal                            ((UINT32)0x00000018)
-#define TPM_ORD_DirWriteAuth                      ((UINT32)0x00000019)
-#define TPM_ORD_DirRead                           ((UINT32)0x0000001A)
-#define TPM_ORD_CMK_CreateBlob                    ((UINT32)0x0000001B)
-#define TPM_ORD_CMK_SetRestrictions               ((UINT32)0x0000001C)
-#define TPM_ORD_CMK_ApproveMA                     ((UINT32)0x0000001D)
-#define TPM_ORD_UnBind                            ((UINT32)0x0000001E)
-#define TPM_ORD_CreateWrapKey                     ((UINT32)0x0000001F)
-#define TPM_ORD_LoadKey                           ((UINT32)0x00000020)
-#define TPM_ORD_GetPubKey                         ((UINT32)0x00000021)
-#define TPM_ORD_EvictKey                          ((UINT32)0x00000022)
-#define TPM_ORD_KeyControlOwner                   ((UINT32)0x00000023)
-#define TPM_ORD_CMK_ConvertMigration              ((UINT32)0x00000024)
-#define TPM_ORD_MigrateKey                        ((UINT32)0x00000025)
-#define TPM_ORD_CreateMigrationBlob               ((UINT32)0x00000028)
-#define TPM_ORD_DAA_Join                          ((UINT32)0x00000029)
-#define TPM_ORD_ConvertMigrationBlob              ((UINT32)0x0000002A)
-#define TPM_ORD_AuthorizeMigrationKey             ((UINT32)0x0000002B)
-#define TPM_ORD_CreateMaintenanceArchive          ((UINT32)0x0000002C)
-#define TPM_ORD_LoadMaintenanceArchive            ((UINT32)0x0000002D)
-#define TPM_ORD_KillMaintenanceFeature            ((UINT32)0x0000002E)
-#define TPM_ORD_LoadManuMaintPub                  ((UINT32)0x0000002F)
-#define TPM_ORD_ReadManuMaintPub                  ((UINT32)0x00000030)
-#define TPM_ORD_DAA_Sign                          ((UINT32)0x00000031)
-#define TPM_ORD_CertifyKey                        ((UINT32)0x00000032)
-#define TPM_ORD_CertifyKey2                       ((UINT32)0x00000033)
-#define TPM_ORD_Sign                              ((UINT32)0x0000003C)
-#define TPM_ORD_Sealx                             ((UINT32)0x0000003D)
-#define TPM_ORD_Quote2                            ((UINT32)0x0000003E)
-#define TPM_ORD_SetCapability                     ((UINT32)0x0000003F)
-#define TPM_ORD_ResetLockValue                    ((UINT32)0x00000040)
-#define TPM_ORD_LoadKey2                          ((UINT32)0x00000041)
-#define TPM_ORD_GetRandom                         ((UINT32)0x00000046)
-#define TPM_ORD_StirRandom                        ((UINT32)0x00000047)
-#define TPM_ORD_SelfTestFull                      ((UINT32)0x00000050)
-#define TPM_ORD_CertifySelfTest                   ((UINT32)0x00000052)
-#define TPM_ORD_ContinueSelfTest                  ((UINT32)0x00000053)
-#define TPM_ORD_GetTestResult                     ((UINT32)0x00000054)
-#define TPM_ORD_Reset                             ((UINT32)0x0000005A)
-#define TPM_ORD_OwnerClear                        ((UINT32)0x0000005B)
-#define TPM_ORD_DisableOwnerClear                 ((UINT32)0x0000005C)
-#define TPM_ORD_ForceClear                        ((UINT32)0x0000005D)
-#define TPM_ORD_DisableForceClear                 ((UINT32)0x0000005E)
-#define TPM_ORD_GetCapabilitySigned               ((UINT32)0x00000064)
-#define TPM_ORD_GetCapability                     ((UINT32)0x00000065)
-#define TPM_ORD_GetCapabilityOwner                ((UINT32)0x00000066)
-#define TPM_ORD_OwnerSetDisable                   ((UINT32)0x0000006E)
-#define TPM_ORD_PhysicalEnable                    ((UINT32)0x0000006F)
-#define TPM_ORD_PhysicalDisable                   ((UINT32)0x00000070)
-#define TPM_ORD_SetOwnerInstall                   ((UINT32)0x00000071)
-#define TPM_ORD_PhysicalSetDeactivated            ((UINT32)0x00000072)
-#define TPM_ORD_SetTempDeactivated                ((UINT32)0x00000073)
-#define TPM_ORD_SetOperatorAuth                   ((UINT32)0x00000074)
-#define TPM_ORD_SetOwnerPointer                   ((UINT32)0x00000075)
-#define TPM_ORD_CreateEndorsementKeyPair          ((UINT32)0x00000078)
-#define TPM_ORD_MakeIdentity                      ((UINT32)0x00000079)
-#define TPM_ORD_ActivateIdentity                  ((UINT32)0x0000007A)
-#define TPM_ORD_ReadPubek                         ((UINT32)0x0000007C)
-#define TPM_ORD_OwnerReadPubek                    ((UINT32)0x0000007D)
-#define TPM_ORD_DisablePubekRead                  ((UINT32)0x0000007E)
-#define TPM_ORD_CreateRevocableEK                 ((UINT32)0x0000007F)
-#define TPM_ORD_RevokeTrust                       ((UINT32)0x00000080)
-#define TPM_ORD_OwnerReadInternalPub              ((UINT32)0x00000081)
-#define TPM_ORD_GetAuditEvent                     ((UINT32)0x00000082)
-#define TPM_ORD_GetAuditEventSigned               ((UINT32)0x00000083)
-#define TPM_ORD_GetAuditDigest                    ((UINT32)0x00000085)
-#define TPM_ORD_GetAuditDigestSigned              ((UINT32)0x00000086)
-#define TPM_ORD_GetOrdinalAuditStatus             ((UINT32)0x0000008C)
-#define TPM_ORD_SetOrdinalAuditStatus             ((UINT32)0x0000008D)
-#define TPM_ORD_Terminate_Handle                  ((UINT32)0x00000096)
-#define TPM_ORD_Init                              ((UINT32)0x00000097)
-#define TPM_ORD_SaveState                         ((UINT32)0x00000098)
-#define TPM_ORD_Startup                           ((UINT32)0x00000099)
-#define TPM_ORD_SetRedirection                    ((UINT32)0x0000009A)
-#define TPM_ORD_SHA1Start                         ((UINT32)0x000000A0)
-#define TPM_ORD_SHA1Update                        ((UINT32)0x000000A1)
-#define TPM_ORD_SHA1Complete                      ((UINT32)0x000000A2)
-#define TPM_ORD_SHA1CompleteExtend                ((UINT32)0x000000A3)
-#define TPM_ORD_FieldUpgrade                      ((UINT32)0x000000AA)
-#define TPM_ORD_SaveKeyContext                    ((UINT32)0x000000B4)
-#define TPM_ORD_LoadKeyContext                    ((UINT32)0x000000B5)
-#define TPM_ORD_SaveAuthContext                   ((UINT32)0x000000B6)
-#define TPM_ORD_LoadAuthContext                   ((UINT32)0x000000B7)
-#define TPM_ORD_SaveContext                       ((UINT32)0x000000B8)
-#define TPM_ORD_LoadContext                       ((UINT32)0x000000B9)
-#define TPM_ORD_FlushSpecific                     ((UINT32)0x000000BA)
-#define TPM_ORD_PCR_Reset                         ((UINT32)0x000000C8)
-#define TPM_ORD_NV_DefineSpace                    ((UINT32)0x000000CC)
-#define TPM_ORD_NV_WriteValue                     ((UINT32)0x000000CD)
-#define TPM_ORD_NV_WriteValueAuth                 ((UINT32)0x000000CE)
-#define TPM_ORD_NV_ReadValue                      ((UINT32)0x000000CF)
-#define TPM_ORD_NV_ReadValueAuth                  ((UINT32)0x000000D0)
-#define TPM_ORD_Delegate_UpdateVerification       ((UINT32)0x000000D1)
-#define TPM_ORD_Delegate_Manage                   ((UINT32)0x000000D2)
-#define TPM_ORD_Delegate_CreateKeyDelegation      ((UINT32)0x000000D4)
-#define TPM_ORD_Delegate_CreateOwnerDelegation    ((UINT32)0x000000D5)
-#define TPM_ORD_Delegate_VerifyDelegation         ((UINT32)0x000000D6)
-#define TPM_ORD_Delegate_LoadOwnerDelegation      ((UINT32)0x000000D8)
-#define TPM_ORD_Delegate_ReadTable                ((UINT32)0x000000DB)
-#define TPM_ORD_CreateCounter                     ((UINT32)0x000000DC)
-#define TPM_ORD_IncrementCounter                  ((UINT32)0x000000DD)
-#define TPM_ORD_ReadCounter                       ((UINT32)0x000000DE)
-#define TPM_ORD_ReleaseCounter                    ((UINT32)0x000000DF)
-#define TPM_ORD_ReleaseCounterOwner               ((UINT32)0x000000E0)
-#define TPM_ORD_EstablishTransport                ((UINT32)0x000000E6)
-#define TPM_ORD_ExecuteTransport                  ((UINT32)0x000000E7)
-#define TPM_ORD_ReleaseTransportSigned            ((UINT32)0x000000E8)
-#define TPM_ORD_GetTicks                          ((UINT32)0x000000F1)
-#define TPM_ORD_TickStampBlob                     ((UINT32)0x000000F2)
+#define TPM_ORD_OIAP                              (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000000A))
+#define TPM_ORD_OSAP                              (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000000B))
+#define TPM_ORD_ChangeAuth                        (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000000C))
+#define TPM_ORD_TakeOwnership                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000000D))
+#define TPM_ORD_ChangeAuthAsymStart               (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000000E))
+#define TPM_ORD_ChangeAuthAsymFinish              (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000000F))
+#define TPM_ORD_ChangeAuthOwner                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000010))
+#define TPM_ORD_DSAP                              (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000011))
+#define TPM_ORD_CMK_CreateTicket                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000012))
+#define TPM_ORD_CMK_CreateKey                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000013))
+#define TPM_ORD_Extend                            (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000014))
+#define TPM_ORD_PcrRead                           (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000015))
+#define TPM_ORD_Quote                             (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000016))
+#define TPM_ORD_Seal                              (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000017))
+#define TPM_ORD_Unseal                            (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000018))
+#define TPM_ORD_DirWriteAuth                      (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000019))
+#define TPM_ORD_DirRead                           (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000001A))
+#define TPM_ORD_CMK_CreateBlob                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000001B))
+#define TPM_ORD_CMK_SetRestrictions               (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000001C))
+#define TPM_ORD_CMK_ApproveMA                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000001D))
+#define TPM_ORD_UnBind                            (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000001E))
+#define TPM_ORD_CreateWrapKey                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000001F))
+#define TPM_ORD_LoadKey                           (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000020))
+#define TPM_ORD_GetPubKey                         (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000021))
+#define TPM_ORD_EvictKey                          (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000022))
+#define TPM_ORD_KeyControlOwner                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000023))
+#define TPM_ORD_CMK_ConvertMigration              (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000024))
+#define TPM_ORD_MigrateKey                        (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000025))
+#define TPM_ORD_CreateMigrationBlob               (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000028))
+#define TPM_ORD_DAA_Join                          (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000029))
+#define TPM_ORD_ConvertMigrationBlob              (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000002A))
+#define TPM_ORD_AuthorizeMigrationKey             (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000002B))
+#define TPM_ORD_CreateMaintenanceArchive          (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000002C))
+#define TPM_ORD_LoadMaintenanceArchive            (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000002D))
+#define TPM_ORD_KillMaintenanceFeature            (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000002E))
+#define TPM_ORD_LoadManuMaintPub                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000002F))
+#define TPM_ORD_ReadManuMaintPub                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000030))
+#define TPM_ORD_DAA_Sign                          (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000031))
+#define TPM_ORD_CertifyKey                        (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000032))
+#define TPM_ORD_CertifyKey2                       (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000033))
+#define TPM_ORD_Sign                              (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000003C))
+#define TPM_ORD_Sealx                             (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000003D))
+#define TPM_ORD_Quote2                            (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000003E))
+#define TPM_ORD_SetCapability                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000003F))
+#define TPM_ORD_ResetLockValue                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000040))
+#define TPM_ORD_LoadKey2                          (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000041))
+#define TPM_ORD_GetRandom                         (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000046))
+#define TPM_ORD_StirRandom                        (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000047))
+#define TPM_ORD_SelfTestFull                      (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000050))
+#define TPM_ORD_CertifySelfTest                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000052))
+#define TPM_ORD_ContinueSelfTest                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000053))
+#define TPM_ORD_GetTestResult                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000054))
+#define TPM_ORD_Reset                             (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000005A))
+#define TPM_ORD_OwnerClear                        (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000005B))
+#define TPM_ORD_DisableOwnerClear                 (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000005C))
+#define TPM_ORD_ForceClear                        (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000005D))
+#define TPM_ORD_DisableForceClear                 (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000005E))
+#define TPM_ORD_GetCapabilitySigned               (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000064))
+#define TPM_ORD_GetCapability                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000065))
+#define TPM_ORD_GetCapabilityOwner                (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000066))
+#define TPM_ORD_OwnerSetDisable                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000006E))
+#define TPM_ORD_PhysicalEnable                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000006F))
+#define TPM_ORD_PhysicalDisable                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000070))
+#define TPM_ORD_SetOwnerInstall                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000071))
+#define TPM_ORD_PhysicalSetDeactivated            (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000072))
+#define TPM_ORD_SetTempDeactivated                (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000073))
+#define TPM_ORD_SetOperatorAuth                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000074))
+#define TPM_ORD_SetOwnerPointer                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000075))
+#define TPM_ORD_CreateEndorsementKeyPair          (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000078))
+#define TPM_ORD_MakeIdentity                      (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000079))
+#define TPM_ORD_ActivateIdentity                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000007A))
+#define TPM_ORD_ReadPubek                         (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000007C))
+#define TPM_ORD_OwnerReadPubek                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000007D))
+#define TPM_ORD_DisablePubekRead                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000007E))
+#define TPM_ORD_CreateRevocableEK                 (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000007F))
+#define TPM_ORD_RevokeTrust                       (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000080))
+#define TPM_ORD_OwnerReadInternalPub              (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000081))
+#define TPM_ORD_GetAuditEvent                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000082))
+#define TPM_ORD_GetAuditEventSigned               (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000083))
+#define TPM_ORD_GetAuditDigest                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000085))
+#define TPM_ORD_GetAuditDigestSigned              (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000086))
+#define TPM_ORD_GetOrdinalAuditStatus             (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000008C))
+#define TPM_ORD_SetOrdinalAuditStatus             (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000008D))
+#define TPM_ORD_Terminate_Handle                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000096))
+#define TPM_ORD_Init                              (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000097))
+#define TPM_ORD_SaveState                         (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000098))
+#define TPM_ORD_Startup                           (TPM_PROTECTED_ORDINAL | ((UINT32)0x00000099))
+#define TPM_ORD_SetRedirection                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x0000009A))
+#define TPM_ORD_SHA1Start                         (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000A0))
+#define TPM_ORD_SHA1Update                        (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000A1))
+#define TPM_ORD_SHA1Complete                      (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000A2))
+#define TPM_ORD_SHA1CompleteExtend                (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000A3))
+#define TPM_ORD_FieldUpgrade                      (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000AA))
+#define TPM_ORD_SaveKeyContext                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000B4))
+#define TPM_ORD_LoadKeyContext                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000B5))
+#define TPM_ORD_SaveAuthContext                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000B6))
+#define TPM_ORD_LoadAuthContext                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000B7))
+#define TPM_ORD_SaveContext                       (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000B8))
+#define TPM_ORD_LoadContext                       (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000B9))
+#define TPM_ORD_FlushSpecific                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000BA))
+#define TPM_ORD_PCR_Reset                         (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000C8))
+#define TPM_ORD_NV_DefineSpace                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000CC))
+#define TPM_ORD_NV_WriteValue                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000CD))
+#define TPM_ORD_NV_WriteValueAuth                 (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000CE))
+#define TPM_ORD_NV_ReadValue                      (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000CF))
+#define TPM_ORD_NV_ReadValueAuth                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000D0))
+#define TPM_ORD_Delegate_UpdateVerification       (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000D1))
+#define TPM_ORD_Delegate_Manage                   (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000D2))
+#define TPM_ORD_Delegate_CreateKeyDelegation      (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000D4))
+#define TPM_ORD_Delegate_CreateOwnerDelegation    (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000D5))
+#define TPM_ORD_Delegate_VerifyDelegation         (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000D6))
+#define TPM_ORD_Delegate_LoadOwnerDelegation      (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000D8))
+#define TPM_ORD_Delegate_ReadTable                (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000DB))
+#define TPM_ORD_CreateCounter                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000DC))
+#define TPM_ORD_IncrementCounter                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000DD))
+#define TPM_ORD_ReadCounter                       (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000DE))
+#define TPM_ORD_ReleaseCounter                    (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000DF))
+#define TPM_ORD_ReleaseCounterOwner               (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000E0))
+#define TPM_ORD_EstablishTransport                (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000E6))
+#define TPM_ORD_ExecuteTransport                  (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000E7))
+#define TPM_ORD_ReleaseTransportSigned            (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000E8))
+#define TPM_ORD_GetTicks                          (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000F1))
+#define TPM_ORD_TickStampBlob                     (TPM_PROTECTED_ORDINAL | ((UINT32)0x000000F2))
 
 #define TSC_ORD_PhysicalPresence                  ((UINT32)0x4000000A)
 #define TSC_ORD_ResetEstablishmentBit             ((UINT32)0x4000000B)
diff --git a/src/tcs/tcs_caps.c b/src/tcs/tcs_caps.c
index c4cff7c..217479a 100644
--- a/src/tcs/tcs_caps.c
+++ b/src/tcs/tcs_caps.c
@@ -105,6 +105,9 @@ get_max_auths(UINT32 *auths)
 	TSS_RESULT result;
 	int i;
 
+	UINT32ToArray(TPM_CAP_PROP_MAX_AUTHSESS, (BYTE *)(&subCap));
+	result = get_cap_uint32(TPM_CAP_PROPERTY, (BYTE *)&subCap, sizeof(subCap), auths);
+#if 0
 	if (TPM_VERSION_IS(1,2)) {
 		UINT32ToArray(TPM_CAP_PROP_MAX_AUTHSESS, (BYTE *)(&subCap));
 		result = get_cap_uint32(TPM_CAP_PROPERTY, (BYTE *)&subCap, sizeof(subCap), auths);
@@ -130,6 +133,7 @@ get_max_auths(UINT32 *auths)
 		result = TCSERR(TSS_E_INTERNAL_ERROR);
 		*auths = 0;
 	}
+#endif
 
 	if (*auths < 2) {
 		LogError("%s reported only %u auth available!", __FUNCTION__, *auths);
diff --git a/src/tspi/obj_context.c b/src/tspi/obj_context.c
index 7bbd869..1340096 100644
--- a/src/tspi/obj_context.c
+++ b/src/tspi/obj_context.c
@@ -1462,7 +1462,9 @@ obj_context_set_tpm_version(TSS_HCONTEXT tspContext, UINT32 ver)
 			break;
 		default:
 			LogError("Invalid TPM version set: %u", ver);
-			result = TSPERR(TSS_E_INTERNAL_ERROR);
+			//result = TSPERR(TSS_E_INTERNAL_ERROR);
+			context->flags &= ~TSS_CONTEXT_FLAGS_TPM_VERSION_MASK;
+			context->flags |= TSS_CONTEXT_FLAGS_TPM_VERSION_2;
 			break;
 	}
 
-- 
1.9.1

